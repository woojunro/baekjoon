-- 코드를 입력하세요
SELECT
    C.CAR_ID,
    C.CAR_TYPE,
    FLOOR(C.DAILY_FEE * 30 * (100 - IFNULL(P.DISCOUNT_RATE, 100)) / 100) AS FEE
FROM
    CAR_RENTAL_COMPANY_CAR AS C
LEFT JOIN
    CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS P
ON
    C.CAR_TYPE = P.CAR_TYPE
AND
    P.DURATION_TYPE = '30일 이상'
WHERE
    C.CAR_TYPE IN ('세단', 'SUV')
AND
    NOT EXISTS (
        SELECT
            1
        FROM
            CAR_RENTAL_COMPANY_RENTAL_HISTORY AS H
        WHERE
            H.CAR_ID = C.CAR_ID
        AND
            H.START_DATE <= '2022-11-30'
        AND
            H.END_DATE >= '2022-11-01'
    )
AND
    FLOOR(C.DAILY_FEE * 30 * (100 - IFNULL(P.DISCOUNT_RATE, 100)) / 100) >= 500000
AND
    FLOOR(C.DAILY_FEE * 30 * (100 - IFNULL(P.DISCOUNT_RATE, 100)) / 100) < 2000000
ORDER BY
    FEE DESC,
    C.CAR_TYPE ASC,
    C.CAR_ID DESC
;